generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model box_bin_inventory {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  box_bin_id String   @db.Uuid
  item_id    String   @db.Uuid
  quantity   Int      @default(0)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @default(now()) @db.Timestamptz(6)
  box_bins   box_bins @relation(fields: [box_bin_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products   products @relation(fields: [item_id], references: [id], onUpdate: NoAction)

  @@unique([box_bin_id, item_id], map: "box_bin_inventory_unique_item")
  @@index([box_bin_id], map: "idx_box_bin_inventory_box_bin_id")
  @@index([item_id], map: "idx_box_bin_inventory_item_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model box_bins {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  box_bin_code      String              @unique @db.VarChar
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  updated_at        DateTime            @default(now()) @db.Timestamptz(6)
  box_bin_inventory box_bin_inventory[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cabinet_inventory {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cabinet_id String   @db.Uuid
  item_id    String   @db.Uuid
  quantity   Int      @default(0)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @default(now()) @db.Timestamptz(6)
  cabinets   cabinets @relation(fields: [cabinet_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products   products @relation(fields: [item_id], references: [id], onUpdate: NoAction)

  @@unique([cabinet_id, item_id], map: "cabinet_inventory_unique_item")
  @@index([cabinet_id], map: "idx_cabinet_inventory_cabinet_id")
  @@index([item_id], map: "idx_cabinet_inventory_item_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cabinets {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cabinet_code      String              @unique @db.VarChar
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  updated_at        DateTime            @default(now()) @db.Timestamptz(6)
  cabinet_inventory cabinet_inventory[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model double_claw_machine_inventory {
  id                     String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  double_claw_machine_id String               @db.Uuid
  item_id                String               @db.Uuid
  quantity               Int                  @default(0)
  created_at             DateTime             @default(now()) @db.Timestamptz(6)
  updated_at             DateTime             @default(now()) @db.Timestamptz(6)
  double_claw_machines   double_claw_machines @relation(fields: [double_claw_machine_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products               products             @relation(fields: [item_id], references: [id], onUpdate: NoAction)

  @@unique([double_claw_machine_id, item_id], map: "double_claw_machine_inventory_unique_item")
  @@index([item_id], map: "idx_double_claw_machine_inventory_item_id")
  @@index([double_claw_machine_id], map: "idx_double_claw_machine_inventory_machine_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model double_claw_machines {
  id                            String                          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  double_claw_machine_code      String                          @unique @db.VarChar
  created_at                    DateTime                        @default(now()) @db.Timestamptz(6)
  updated_at                    DateTime                        @default(now()) @db.Timestamptz(6)
  double_claw_machine_inventory double_claw_machine_inventory[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model event_outbox {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  topic            String    @db.VarChar
  event_type       String    @db.VarChar
  entity_type      String    @db.VarChar
  entity_id        String    @db.Uuid
  payload          Json
  created_at       DateTime  @default(now()) @db.Timestamptz(6)
  published_at     DateTime? @db.Timestamptz(6)
  publish_attempts Int       @default(0)
  last_error       String?

  @@index([created_at], map: "idx_event_outbox_created_at")
}

model forecast_predictions {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  item_id               String    @db.Uuid
  horizon_days          Int
  avg_daily_delta       Decimal?  @db.Decimal
  days_to_stockout      Decimal?  @db.Decimal
  suggested_reorder_qty Int?
  suggested_order_date  DateTime? @db.Date
  confidence            Decimal?  @db.Decimal
  features              Json?
  computed_at           DateTime  @db.Timestamptz(6)
  products              products  @relation(fields: [item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([computed_at], map: "idx_forecast_predictions_computed_at")
  @@index([item_id], map: "idx_forecast_predictions_item_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model keychain_machine_inventory {
  id                  String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  keychain_machine_id String            @db.Uuid
  item_id             String            @db.Uuid
  quantity            Int               @default(0)
  created_at          DateTime          @default(now()) @db.Timestamptz(6)
  updated_at          DateTime          @default(now()) @db.Timestamptz(6)
  products            products          @relation(fields: [item_id], references: [id], onUpdate: NoAction)
  keychain_machines   keychain_machines @relation(fields: [keychain_machine_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([keychain_machine_id, item_id], map: "keychain_machine_inventory_unique_item")
  @@index([item_id], map: "idx_keychain_machine_inventory_item_id")
  @@index([keychain_machine_id], map: "idx_keychain_machine_inventory_machine_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model keychain_machines {
  id                         String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  keychain_machine_code      String                       @unique @db.VarChar
  created_at                 DateTime                     @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime                     @default(now()) @db.Timestamptz(6)
  keychain_machine_inventory keychain_machine_inventory[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model notifications {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type         String    @db.VarChar
  severity     String    @db.VarChar
  message      String
  recipient_id String?   @db.Uuid
  item_id      String?   @db.Uuid
  inventory_id String?   @db.Uuid
  via          String[]
  metadata     Json?
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  delivered_at DateTime? @db.Timestamptz(6)
  products     products? @relation(fields: [item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([created_at], map: "idx_notifications_created_at")
  @@index([recipient_id], map: "idx_notifications_recipient_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model products {
  id                            String                          @id(map: "items_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sku                           String?                         @unique @db.VarChar
  category                      String                          @db.VarChar
  subcategory                   String?                         @db.VarChar
  name                          String
  description                   String?
  reorder_point                 Int?                            @default(10)
  target_stock_level            Int?                            @default(50)
  lead_time_days                Int?                            @default(7)
  unit_cost                     Decimal?                        @db.Decimal(10, 2)
  is_active                     Boolean                         @default(true)
  image_url                     String?
  notes                         String?
  created_at                    DateTime                        @default(now()) @db.Timestamptz(6)
  updated_at                    DateTime                        @default(now()) @db.Timestamptz(6)
  box_bin_inventory             box_bin_inventory[]
  cabinet_inventory             cabinet_inventory[]
  double_claw_machine_inventory double_claw_machine_inventory[]
  forecast_predictions          forecast_predictions[]
  keychain_machine_inventory    keychain_machine_inventory[]
  notifications                 notifications[]
  rack_inventory                rack_inventory[]
  shipment_items                shipment_items[]
  single_claw_machine_inventory single_claw_machine_inventory[]
  stock_movements               stock_movements[]

  @@index([category], map: "idx_items_category")
  @@index([sku], map: "idx_items_sku")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model rack_inventory {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rack_id    String   @db.Uuid
  item_id    String   @db.Uuid
  quantity   Int      @default(0)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @default(now()) @db.Timestamptz(6)
  products   products @relation(fields: [item_id], references: [id], onUpdate: NoAction)
  racks      racks    @relation(fields: [rack_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([rack_id, item_id], map: "rack_inventory_unique_item")
  @@index([item_id], map: "idx_rack_inventory_item_id")
  @@index([rack_id], map: "idx_rack_inventory_rack_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model racks {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  rack_code      String           @unique @db.VarChar
  created_at     DateTime         @default(now()) @db.Timestamptz(6)
  updated_at     DateTime         @default(now()) @db.Timestamptz(6)
  rack_inventory rack_inventory[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model shipment_items {
  id                        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shipment_id               String    @db.Uuid
  item_id                   String    @db.Uuid
  ordered_quantity          Int
  received_quantity         Int       @default(0)
  unit_cost                 Decimal?  @db.Decimal(10, 2)
  destination_location_type String?   @db.VarChar
  destination_location_id   String?   @db.Uuid
  notes                     String?
  created_at                DateTime  @default(now()) @db.Timestamptz(6)
  updated_at                DateTime  @default(now()) @db.Timestamptz(6)
  products                  products  @relation(fields: [item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  shipments                 shipments @relation(fields: [shipment_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([item_id], map: "idx_shipment_items_item_id")
  @@index([shipment_id], map: "idx_shipment_items_shipment_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model shipments {
  id                     String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  shipment_number        String?          @unique @db.VarChar
  supplier_name          String?          @db.VarChar
  status                 String           @default("PENDING") @db.VarChar
  order_date             DateTime         @default(dbgenerated("CURRENT_DATE")) @db.Date
  expected_delivery_date DateTime?        @db.Date
  actual_delivery_date   DateTime?        @db.Date
  total_cost             Decimal?         @db.Decimal(10, 2)
  notes                  String?
  created_by             String?          @db.Uuid
  created_at             DateTime         @default(now()) @db.Timestamptz(6)
  updated_at             DateTime         @default(now()) @db.Timestamptz(6)
  shipment_items         shipment_items[]
  users                  users?           @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([expected_delivery_date], map: "idx_shipments_expected_delivery")
  @@index([status], map: "idx_shipments_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model single_claw_machine_inventory {
  id                     String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  single_claw_machine_id String               @db.Uuid
  item_id                String               @db.Uuid
  quantity               Int                  @default(0)
  created_at             DateTime             @default(now()) @db.Timestamptz(6)
  updated_at             DateTime             @default(now()) @db.Timestamptz(6)
  products               products             @relation(fields: [item_id], references: [id], onUpdate: NoAction)
  single_claw_machines   single_claw_machines @relation(fields: [single_claw_machine_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([single_claw_machine_id, item_id], map: "single_claw_machine_inventory_unique_item")
  @@index([item_id], map: "idx_single_claw_machine_inventory_item_id")
  @@index([single_claw_machine_id], map: "idx_single_claw_machine_inventory_machine_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model single_claw_machines {
  id                            String                          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  single_claw_machine_code      String                          @unique @db.VarChar
  created_at                    DateTime                        @default(now()) @db.Timestamptz(6)
  updated_at                    DateTime                        @default(now()) @db.Timestamptz(6)
  single_claw_machine_inventory single_claw_machine_inventory[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model stock_movements {
  id               BigInt   @id @default(autoincrement())
  location_type    String   @db.VarChar
  item_id          String   @db.Uuid
  from_location_id String?  @db.Uuid
  to_location_id   String?  @db.Uuid
  quantity_change  Int
  reason           String   @db.VarChar
  actor_id         String?  @db.Uuid
  at               DateTime @default(now()) @db.Timestamptz(6)
  metadata         Json?
  users            users?   @relation(fields: [actor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  products         products @relation(fields: [item_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([at], map: "idx_stock_movements_at")
  @@index([item_id], map: "idx_stock_movements_item_id")
  @@index([reason], map: "idx_stock_movements_reason")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  id              String            @id @db.Uuid
  role            String
  full_name       String?
  email           String?           @unique
  created_at      DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?         @default(now()) @db.Timestamptz(6)
  shipments       shipments[]
  stock_movements stock_movements[]
}
